#!/usr/bin/env sh
# Happy Homes Security Pre-commit Hook
# 
# This hook ensures no localStorage/sessionStorage violations
# are committed to the repository.
#
# To bypass (NOT RECOMMENDED): git commit --no-verify

. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ”’ Running Happy Homes Security Checks..."

# Run security scan
npm run security-check

if [ $? -ne 0 ]; then
  echo ""
  echo "ğŸš¨ COMMIT BLOCKED: Security violations detected!"
  echo ""
  echo "âŒ localStorage/sessionStorage usage found in your changes."
  echo "âœ… Please use backend APIs with HTTP-only cookies instead."
  echo ""
  echo "ğŸ“š See SECURITY.md for proper implementation patterns."
  echo ""
  echo "âš ï¸  To bypass this check (NOT RECOMMENDED): git commit --no-verify"
  echo ""
  exit 1
fi

echo "âœ… Security checks passed - commit allowed"

# Run linting
npm run lint

if [ $? -ne 0 ]; then
  echo ""
  echo "ğŸš¨ COMMIT BLOCKED: ESLint violations detected!"
  echo ""
  echo "Please fix linting errors before committing."
  echo ""
  exit 1
fi

echo "âœ… All checks passed - proceeding with commit"